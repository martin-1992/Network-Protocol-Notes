
## 与 HTTP 协作的 Web 服务器
　　一台 Web 服务器可搭建多个独立域名的 Web 网站，也可作为通信路径上的中转服务器提升传输效率。

### 用单台虚拟主机实现多个域名
　　HTTP/1.1 规范允许一台 HTTP 服务器搭建多个 Web 站点。即使物理层面只有一台服务器，但只要使用虚拟主机的功能，则可以假想已具有多台服务器。在互联网上，域名通过 DNS 服务映射到 IP 地址（域名解析）之后访问目标网站。可见，当请求发送到服务器时，已经是以 IP 地址形式访问了。<br />
　　如果有多个域名同时部署在同一个服务器上（相同的 IP 地址），使用 DNS 服务解析域名后，两者的访问地址相同。比如一台服务器托管了 www.tricorder.jp 和 www.hackr.jp 这两个域名，当请求发送到服务器时，这两个域名的 IP 地址是一样的，这是就必须在 Host 首部内完整指定主机名或域名的 URI，明确指定要访问哪个域名。

![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p1.png)

### 通信数据转发程序 ：代理、网关、隧道
　　HTTP 通信时，除客户端和服务器以外，还有一些用于通信数据转发的应用程序，例如代理、网关和隧道。它们可以配合服务器工作。这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应再转发给客户端。
- **代理，转发请求功能的应用程序。** 接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端。每次转发时，需要附加 Via 首部字段以标记出经过的主机信息。代理服务器常用场景：用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的，等等。代理有多种使用方法，分为是否使用缓存和是否会修改报文。缓存代理，会预先将资源副本（缓存）保存在代理服务器上，当代理接收到相同资源的请求时，则将之前的缓存资源作为响应返回，无需到服务器端获取。透明代理，转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理，而对报文做加工处理的则为非透明代理。

![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p2.png)

- **网关，是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，并对请求进行处理，其工作机制和代理相似。** 网关能使通信线路上的服务器提供非 HTTP 协议服务。利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。比如，网关可以连接数据库，使用 SQL 语句查询数据。另外，在 Web 购物网站上进行信用卡结算时，网关可以和信用卡结算系统联动。

![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p3.png)

- **隧道，是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。** 隧道可按要求建立起一条与其他服务器的通信线路，使用 SSL 等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信，其本身不会去解析 HTTP 请求，即请求保持原样中转给之后的服务器。隧道会在通信双方断开连接时结束。

![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p4.png)

### 保存资源的缓存
　　缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存可减少对源服务器的访问，因此也就节省了通信流量和通信时间。缓存服务器是代理服务器的一种，并归类在缓存代理类型中。换句话说，当代理转发从服务器返回的响应时，代理服务器将会保存一份资源的副本。<br />
　　缓存服务器的优势在于利用缓存可避免多次从源服务器转发资源。因此客户端可就近从缓存服务器上获取资源，而源服务器也不必多次处理相同的请求了，减少源服务器的压力。

![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p5.png)

#### 缓存有效期
　　缓存存在有效期问题，当源服务器的资源更新时，如果还是使用不变的缓存，那就会返回更新前的“旧”资源了。缓存服务器通过向源服务器确认资源的有效性。若判断缓存失效，缓存服务器将会再次从源服务器上获取“新”资源。
  
![Aaron Swartz](https://raw.githubusercontent.com/martin-1992/http_notebook/master/chapter_5/chapter_5_p6.png)

#### 客户端的缓存
　　客户端缓存称为临时网络文件（Temporary Internet File），浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘内读取。和和缓存服务器相同的一点是，当判定缓存过期后，会向源服务器确认资源的有效性。若判断浏览器缓存失效，浏览器会再次请求新资源。
